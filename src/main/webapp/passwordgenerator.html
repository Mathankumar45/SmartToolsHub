<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Generator - Smart Tools Hub</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Specific styles for this page -->
    <style>
        body { margin: 0; font-family: Arial, sans-serif; background: #f7f9fc; }

        /* NAVBAR (Same as index.html) */
        .navbar {
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            border-bottom: 1px solid #ddd;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .logo { font-size: 22px; font-weight: bold; color: #0066ff; text-decoration: none; }
        .nav-links a { margin: 0 15px; text-decoration: none; color: #333; }
        .user-info { display: flex; align-items: center; gap: 15px; font-weight: bold; }
        .logout-btn { padding: 8px 14px; background: #0066ff; color: white; border: none; border-radius: 6px; cursor: pointer; }

        /* MAIN TOOL CONTAINER */
        .tool-container {
            max-width: 600px;
            margin: 40px auto;
            padding: 30px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
        }
        .tool-container h1 { color: #333; }
        .tool-container p { color: #666; }

        /* PASSWORD DISPLAY */
        .password-display {
            display: flex;
            background: #f0f2f5;
            padding: 15px;
            border-radius: 8px;
            margin: 25px 0;
            align-items: center;
            justify-content: space-between;
        }
        #passwordResult {
            font-family: 'Courier New', Courier, monospace;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            word-wrap: break-word;
            word-break: break-all;
            flex-grow: 1;
            text-align: left;
            padding-right: 10px;
        }
        .copy-btn {
            background: #0066ff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            flex-shrink: 0;
        }
        .copy-btn:hover { background: #0052cc; }

        /* OPTIONS SECTION */
        .options {
            text-align: left;
            margin-top: 20px;
        }
        .option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .option label {
            font-weight: bold;
            color: #555;
        }
        .option input[type="range"] {
            width: 60%;
        }
        .option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        #lengthValue {
            font-weight: bold;
            color: #0066ff;
            margin-left: 10px;
        }

        /* GENERATE BUTTON */
        .generate-btn {
            width: 100%;
            padding: 15px;
            margin-top: 25px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .generate-btn:hover { background: #218838; }
    </style>
</head>
<body>

<!-- NAVBAR (Same as index.html) -->
<div class="navbar">
    <a href="index.html" class="logo">üîß Smart Tools Hub</a>
    <div class="nav-links">
        <a href="index.html">Home</a>
    </div>
    <div class="user-info">
        <span id="username">Loading...</span>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
</div>

<!-- MAIN TOOL CONTENT -->
<div class="tool-container">
    <h1>üîê Password Generator</h1>
    <p>Create strong and secure passwords to keep your accounts safe.</p>

    <div class="password-display">
        <span id="passwordResult">P@ssw0rd123!</span>
        <button class="copy-btn" id="copyBtn">Copy</button>
    </div>

    <div class="options">
        <div class="option">
            <label for="length">Password Length</label>
            <div>
                <input type="range" id="length" min="8" max="32" value="16">
                <span id="lengthValue">16</span>
            </div>
        </div>
        <div class="option">
            <label for="uppercase">Include Uppercase Letters (A-Z)</label>
            <input type="checkbox" id="uppercase" checked>
        </div>
        <div class="option">
            <label for="lowercase">Include Lowercase Letters (a-z)</label>
            <input type="checkbox" id="lowercase" checked>
        </div>
        <div class="option">
            <label for="numbers">Include Numbers (0-9)</label>
            <input type="checkbox" id="numbers" checked>
        </div>
        <div class="option">
            <label for="symbols">Include Symbols (!@#$%^&*)</label>
            <input type="checkbox" id="symbols" checked>
        </div>
    </div>

    <button class="generate-btn" id="generateBtn">Generate Password</button>
</div>

<script>
    // --- DOM ELEMENTS ---
    const passwordResult = document.getElementById('passwordResult');
    const copyBtn = document.getElementById('copyBtn');
    const generateBtn = document.getElementById('generateBtn');
    const lengthSlider = document.getElementById('length');
    const lengthValue = document.getElementById('lengthValue');
    const uppercaseCheckbox = document.getElementById('uppercase');
    const lowercaseCheckbox = document.getElementById('lowercase');
    const numbersCheckbox = document.getElementById('numbers');
    const symbolsCheckbox = document.getElementById('symbols');

    // --- SESSION & LOGOUT (Same as index.html) ---
    fetch("/api/auth/session")
        .then(res => res.json())
        .then(data => {
            if (data.loggedIn) {
                document.getElementById("username").textContent = data.email;
            } else {
                window.location.href = "login.html";
            }
        })
        .catch(error => {
            console.error("Error checking session:", error);
            window.location.href = "login.html";
        });

    function logout() {
        fetch("/api/auth/logout", { method: "POST" })
            .then(() => window.location.href = "login.html");
    }

    // --- PASSWORD GENERATOR LOGIC ---

    const randomFunc = {
        lower: getRandomLower,
        upper: getRandomUpper,
        number: getRandomNumber,
        symbol: getRandomSymbol
    };

    // Event Listeners
    generateBtn.addEventListener('click', generatePassword);
    copyBtn.addEventListener('click', copyPassword);
    lengthSlider.addEventListener('input', () => {
        lengthValue.textContent = lengthSlider.value;
    });

    // Generate password on page load
    generatePassword();

    function generatePassword() {
        const length = +lengthSlider.value;
        const hasLower = lowercaseCheckbox.checked;
        const hasUpper = uppercaseCheckbox.checked;
        const hasNumber = numbersCheckbox.checked;
        const hasSymbol = symbolsCheckbox.checked;

        passwordResult.innerText = generate(length, hasLower, hasUpper, hasNumber, hasSymbol);
    }

    function generate(length, lower, upper, number, symbol) {
        let generatedPassword = '';
        const typesCount = lower + upper + number + symbol;
        const typesArr = [{lower}, {upper}, {number}, {symbol}].filter(item => Object.values(item)[0]);
        
        if(typesCount === 0) {
            return ''; // Return empty if no types are selected
        }

        for(let i=0; i<length; i+=typesCount) {
            typesArr.forEach(type => {
                const funcName = Object.keys(type)[0];
                generatedPassword += randomFunc[funcName]();
            });
        }

        const finalPassword = generatedPassword.slice(0, length);
        
        return finalPassword;
    }

    function getRandomLower() {
        return String.fromCharCode(Math.floor(Math.random() * 26) + 97);
    }

    function getRandomUpper() {
        return String.fromCharCode(Math.floor(Math.random() * 26) + 65);
    }

    function getRandomNumber() {
        return String.fromCharCode(Math.floor(Math.random() * 10) + 48);
    }

    function getRandomSymbol() {
        const symbols = '!@#$%^&*(){}[]=<>/,.';
        return symbols[Math.floor(Math.random() * symbols.length)];
    }

    async function copyPassword() {
        const password = passwordResult.innerText;
        if (!password) {
            return;
        }
        try {
            await navigator.clipboard.writeText(password);
            alert('Password copied to clipboard!');
        } catch (err) {
            alert('Failed to copy password');
        }
    }
</script>

</body>
</html>